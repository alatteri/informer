#!/usr/bin/perl
use strict;

sub SYSTEM  { system(shift) && die $!; }
sub CHDIR   { chdir(shift) || die $!; }
sub CWD     { chomp(my $cwd = `pwd`); return $cwd; }

sub main {
    my $cwd = CWD();

    SYSTEM("tar zxvf Django-0.96.tar.gz");
    CHDIR('Django-0.96');

    SYSTEM("python setup.py install --prefix=$cwd/..");
    CHDIR($cwd);

    SYSTEM("tar zxvf django-rest-interface.tar.gz");

    CHDIR("..");
    my $instdir = CWD();
    my @installs = glob("$instdir/lib/python*/site-packages");
    CHDIR($cwd);

    foreach my $install (@installs) {
        SYSTEM("cp -Rf django-rest-interface/django_restapi $install/");
    }

    my $informpath = join(':', @installs);
    my $lines = '-'x80;

    print <<EOM;

$lines
Third party install complete. Please add the following to your ~/.cshrc file:
$lines

set INFORMPATH=$informpath
setenv DJANGO_SETTINGS_MODULE instinctual.settings

if ( \$?PYTHONPATH ) then
    setenv PYTHONPATH "\${INFORMPATH}:\${PYTHONPATH}"
else
    setenv PYTHONPATH \${INFORMPATH}
endif
EOM
}

main();
