#!/usr/bin/env python

# ------------------------------------------------------------------------------
# START BOOTSTRAP
# ------------------------------------------------------------------------------
try:
    import instinctual
except ImportError, e:
    import os
    import sys
    lib = os.sep.join(os.path.abspath(__file__).split(os.sep)[:-2] + ['lib'])
    sys.path.append(lib)
    import sitecustomize
# ------------------------------------------------------------------------------
# END BOOTSTRAP
# ------------------------------------------------------------------------------

import sys
import instinctual
from instinctual.informer.client import Client, AppEvent
from instinctual.parser.subject import DiscreetAppSubject
from instinctual.parser.observer import Observer

LOG = instinctual.getLogger(sys.argv[0])

class MyObserver(Observer):
    def process(self, event):
        appEvent = AppEvent(event)

        LOG.warn(''.join(['-'*20, 'App Event', '-'*20]))
        for (key, val) in appEvent.asDict().items():
            LOG.warn("%s: %s" % (key, val))
        LOG.warn(''.join(['-'*20, '---------', '-'*20]))

        client = Client()
        client.postAppEvent(appEvent)

if __name__ == '__main__':
    observer = MyObserver()
    # app = DiscreetAppSubject(sys.argv[1], wait=False)
    app = DiscreetAppSubject(sys.argv[1], wait=True)
    app.registerObserver(observer)
    app.operate()
