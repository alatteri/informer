#!/bin/sh
#
# description: Starts and stops informer service daemons
#

# Source function library.
if [ -f /etc/init.d/functions ] ; then
  . /etc/init.d/functions
elif [ -f /etc/rc.d/init.d/functions ] ; then
  . /etc/rc.d/init.d/functions
else
  exit 0
fi

# Avoid using root's TMPDIR
unset TMPDIR

# Source networking configuration.
. /etc/sysconfig/network

# Check that networking is up.
[ ${NETWORKING} = "no" ] && exit 0


USER="$2"
FLAME_PID="$3"

RETVAL=0

UPLOADER="/usr/discreet/sparks/instinctual/informer/bin/uploader"
UPLOADER_FLAGS="-D"

start() {
    if [ ! -z "$FLAME_PID" ]; then
        echo "---> flame pid specified as $FLAME_PID"
        UPLOADER_FLAGS="$UPLOADER_FLAGS -P $FLAME_PID"
        echo "FLAGS are: $UPLOADER_FLAGS"
    fi

    echo -n $"Starting informer uploader: "
    if [ -z "$USER" ]; then
        echo "Running with default user"
        daemon $UPLOADER $UPLOADER_FLAGS
    else
        echo "Running with user=$USER"
        daemon --user=$USER $UPLOADER $UPLOADER_FLAGS
    fi
    RETVAL=$?
    echo
    return $RETVAL
}

case "$1" in
  start)
  	start
	;;
  *)
	echo $"Usage: $0 {start} [user]"
	exit 1
esac

exit $?
