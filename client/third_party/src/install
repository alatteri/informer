#!/usr/bin/perl
use strict;

sub SYSTEM  { system(shift) && die $!; }
sub CHDIR   { chdir(shift) || die $!; }
sub CWD     { chomp(my $cwd = `pwd`); return $cwd; }

sub main {
    my $cwd = CWD();

    CHDIR('..');
    my $third_party = CWD();

    CHDIR('..');
    my $top = CWD();

    CHDIR($cwd);

    SYSTEM('tar zxvf httplib2-0.3.0.tar.gz');
    CHDIR('httplib2-0.3.0');
    SYSTEM("python setup.py install --prefix=$third_party");

    CHDIR($cwd);

    my @installs = glob("$third_party/lib/python*/site-packages");
    my $informpath = join(':', $top, $third_party, @installs);

    if (exists $ENV{PYTHONPATH}) {
        $ENV{PYTHONPATH} = "$informpath:$ENV{PYTHONPATH}";
    } else {
        $ENV{PYTHONPATH} = "$informpath";
    }

    SYSTEM('tar zxvf restclient-0.9.8.tar.gz');
    CHDIR('restclient-0.9.8');
    SYSTEM("python setup.py install --prefix=$third_party");

    CHDIR($cwd);

    my $lines = '-'x80;
    print <<EOM;

$lines
Third party install complete. Please add the following to your ~/.cshrc file:
$lines

set INFORMCLIENT=$informpath
setenv DJANGO_SETTINGS_MODULE instinctual.settings

if ( \$?PYTHONPATH ) then
    setenv PYTHONPATH "\${INFORMCLIENT}:\${PYTHONPATH}"
else
    setenv PYTHONPATH \${INFORMCLIENT}
endif
EOM
}

main();
